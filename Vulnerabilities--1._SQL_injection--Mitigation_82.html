<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Mitigation</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Mitigation</h1><br/><p><ul><li>Untrusted input is acceptable by the application. There are several ways to mitigate injection vulnerability, whitelisting, regex, etc. All fve should be used together for a defense in depth approach.<ul><li>HtmlEncode all user input.</li><li>Using static analysis tools. Most static analysis for languages like .Net, Java, python are accurate. However static analysis can become an issue when injection comes from JavaScript and CSS.</li><li>Parameterize SQL queries. Use SQL methods provided by the programming language or framework that parameterize the statements, so that the SQL parser can distinguish between code and data.</li><li>Use Stored Procedures. Stored procedures will generally help the SQL parser differentiate code and data. However Stored Procedures can be used to build dynamic SQL statements allowing the code and data to become blended together causing the it to become vulnerable to injection.</li></ul></li></ul></p><p><ul><li>Parameterized SQL Queries<ul><li></li></ul></li></ul><div class="codebox"><pre>String query = “SELECT id, frstname, lastname FROM authors WHERE forename = ? and surname = ?”<span style="color:#ff9d00;font-weight:700">;</span><br />PreparedStatement pstmt = connection.prepareStatement<span style="color:#ff9d00;font-weight:700">(</span> query <span style="color:#ff9d00;font-weight:700">);</span><br />pstmt.setString<span style="color:#ff9d00;font-weight:700">(</span> 1, frstname <span style="color:#ff9d00;font-weight:700">);</span><br />pstmt.setString<span style="color:#ff9d00;font-weight:700">(</span> 2, lastname <span style="color:#ff9d00;font-weight:700">);</span></pre></div><ul><li>In this example the string ‘query’ is constructed in a way that it does not rely on any client input, and the ‘PreparedStatement’ is constructed from that string. When the client input is to be entered into the SQl, the ‘setString’ function is used and the first question mark “?” is replaced by the string value of ‘firstname’, the second question mark is replaced by the value of ‘lastname’. When the ‘setString’ function is called, this function automatically checks that no SQL syntax is contained within the string value. Most prepared statement APIs allow you to specify the type that should be entered, e.g. ‘setInt’, or ‘setBinary’, etc.</li></ul></p><p><ul><li>Using Flexible Parameterized Statements<ul><li>Functional requirements often need the SQL query being executed to be fexible based on the user input, e.g. if theend user specifes a time span for their transaction search then this should be used, or they might wish to query basedon either surname or forename, or both. In this case the safe string concatenation above could be used, however from a maintenance point of view this could invite future programmers to misunderstand the diference between safeconcatenation and the unsafe version (using input string values directly).One option for fexible parameterized statements is to use ‘if’ statements to select the correct query based on theinput values provided, for example:<ul><li></li></ul></li></ul></li></ul><div class="codebox"><pre>1 String query<span style="color:#ff9d00;font-weight:700">;</span><br />2 PreparedStatement pstmt<span style="color:#ff9d00;font-weight:700">;</span><br />3<br />4 <span style="color:#ff9d00;font-weight:700">if</span> <span style="color:#333333;font-weight:400">( (frstname!= NULL &amp;&amp; frstname.length != 0) &amp;&amp;<br />5 lastname!= NULL &amp;&amp; lastname.length != 0)</span> ) <span style="color:#ff9d00;font-weight:700">{</span><br />6 query = “Select id, frstname, lastname FROM authors WHERE forename = ? and surname = ?”<br />7 pstmt = connection.prepareStatement<span style="color:#ff9d00;font-weight:700">(</span> query <span style="color:#ff9d00;font-weight:700">);</span><br />8 pstmt.setString<span style="color:#ff9d00;font-weight:700">(</span> 1, frstname <span style="color:#ff9d00;font-weight:700">);</span><br />9 pstmt.setString<span style="color:#ff9d00;font-weight:700">(</span> 2, lastname <span style="color:#ff9d00;font-weight:700">);</span><br />10 <span style="color:#ff9d00;font-weight:700">}</span><br />11 <span style="color:#ff9d00;font-weight:700">else</span> <span style="color:#ff9d00;font-weight:700">if</span> <span style="color:#333333;font-weight:400">(frstname != NULL &amp;&amp; frstname.length != 0)</span> <span style="color:#ff9d00;font-weight:700">{</span><br />12 query = “Select id, frstname, lastname FROM authors WHERE forename = ?”<span style="color:#ff9d00;font-weight:700">;</span><br />13 pstmt = connection.prepareStatement<span style="color:#ff9d00;font-weight:700">(</span> query <span style="color:#ff9d00;font-weight:700">);</span><br />14 pstmt.setString<span style="color:#ff9d00;font-weight:700">(</span> 1, frstname <span style="color:#ff9d00;font-weight:700">);</span><br />15 <span style="color:#ff9d00;font-weight:700">}</span><br />16 <span style="color:#ff9d00;font-weight:700">else</span> <span style="color:#ff9d00;font-weight:700">if</span> <span style="color:#333333;font-weight:400">(lastname != NULL &amp;&amp; lastname.length != 0){<br />17 query = “Select id, frstname, lastname FROM authors WHERE surname= ?”;<br />18 pstmt = connection.prepareStatement( query );<br />19 pstmt.setString( 1, lastname);<br />20 }<br />21 else{<br />22 throw NameNotSpecifedException(); }</span></pre></div></p></div>
</body>
</html>
